---
# ─── Dotfile Config Installation ──────────────────────────

# Create target directories
- name: Create config directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: "0755"
  loop:
    - "{{ ansible_env.HOME }}/.config/wezterm"
    - "{{ ansible_env.HOME }}/.config/nvim"
    - "{{ ansible_env.HOME }}/.config/atuin"
    - "{{ ansible_env.HOME }}/.config/btop"
    - "{{ ansible_env.HOME }}/.config/mise"
    - "{{ ansible_env.HOME }}/.config/zed"
    - "{{ ansible_env.HOME }}/.ssh"
    - "{{ ansible_env.HOME }}/.claude"

# ─── Symlinked configs ───────────────────────────────────

- name: Symlink .zshrc
  ansible.builtin.file:
    src: "{{ dotfiles_dir }}/zsh/.zshrc"
    dest: "{{ ansible_env.HOME }}/.zshrc"
    state: link
    force: true
  when: install_zshrc

- name: Symlink .gitconfig
  ansible.builtin.file:
    src: "{{ dotfiles_dir }}/git/.gitconfig"
    dest: "{{ ansible_env.HOME }}/.gitconfig"
    state: link
    force: true
  when: install_gitconfig

- name: Symlink WezTerm config
  ansible.builtin.file:
    src: "{{ dotfiles_dir }}/wezterm/wezterm.lua"
    dest: "{{ ansible_env.HOME }}/.config/wezterm/wezterm.lua"
    state: link
    force: true
  when: install_wezterm_config

- name: Symlink Starship config
  ansible.builtin.file:
    src: "{{ dotfiles_dir }}/starship/starship.toml"
    dest: "{{ ansible_env.HOME }}/.config/starship.toml"
    state: link
    force: true
  when: install_starship_config

- name: Symlink tmux config
  ansible.builtin.file:
    src: "{{ dotfiles_dir }}/tmux/.tmux.conf"
    dest: "{{ ansible_env.HOME }}/.tmux.conf"
    state: link
    force: true
  when: install_tmux_config

- name: Symlink Atuin config
  ansible.builtin.file:
    src: "{{ dotfiles_dir }}/atuin/config.toml"
    dest: "{{ ansible_env.HOME }}/.config/atuin/config.toml"
    state: link
    force: true
  when: install_atuin_config

- name: Symlink mise config
  ansible.builtin.file:
    src: "{{ dotfiles_dir }}/mise/config.toml"
    dest: "{{ ansible_env.HOME }}/.config/mise/config.toml"
    state: link
    force: true
  when: install_mise_config

- name: Symlink Zed config
  ansible.builtin.file:
    src: "{{ dotfiles_dir }}/zed/settings.json"
    dest: "{{ ansible_env.HOME }}/.config/zed/settings.json"
    state: link
    force: true
  when: install_zed_config

# ─── Copied configs (apps that rewrite these files) ──────

- name: Copy btop config
  ansible.builtin.copy:
    src: "{{ dotfiles_dir }}/btop/btop.conf"
    dest: "{{ ansible_env.HOME }}/.config/btop/btop.conf"
    mode: "0644"
  when: install_btop_config

- name: Copy SSH config
  ansible.builtin.copy:
    src: "{{ dotfiles_dir }}/ssh/config"
    dest: "{{ ansible_env.HOME }}/.ssh/config"
    mode: "0644"
  when: install_ssh_config

# ─── iTerm2 preferences ─────────────────────────────────

- name: Import iTerm2 preferences
  ansible.builtin.shell: |
    defaults import com.googlecode.iterm2 "{{ dotfiles_dir }}/iterm2/com.googlecode.iterm2.plist"
  when: install_iterm2_config
  changed_when: true
